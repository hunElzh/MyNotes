## 基本概念

### 集群、节点、分片的基本概念

- 集群：集群是由一个或者多个拥有相同 `cluster.name` 配置的节点组成的一个服务。
- 节点：即一个正在运行的 ES 服务。节点又被分为主节点和普通的节点
  - 主节点：负责管理集群范围内的所有变更操作，例如增删索引、增删节点等。
  - 节点：即一个集群中普通的节点
- *分片*：一个Luence实例；底层存储文档的地方；组成索引的底层存储结构。当集群规模扩大或者缩小时，ES会
  - 主分片：存储所有文档的分片（主分片的数目决定着当前索引能够保存的最大数据量）
  - 副本分片：一个主分片的拷贝

> 一些小细节
>
> - 集群
>   1. 集群中的节点它们共同承担数据和负载的压力，并且当由节点加入集群中或者从集群中移除节点时，集群将会重新平均分布节点中所有的数据。
>   2. 只要启动了一个ES服务，就算里面没有文档，这个ES服务也被称之为集群，只不过这是一个只有一个节点，并且节点中没有文档的*空集群*
> - 节点
>   1. **每个节点** 都知道 **任意文档** 在 ES 中所处的位置。所以无论我们将请求发送至哪个节点，ES都能转发请求，随后将对应需要查找的文档返回给我们。
> - 分片
>   1. ES 中的**索引**，实际上**指向**一个或者多个**物理分片** 。
>   2. 技术上来说，一个主分片最大能够存储 Integer.MAX_VALUE - 128 个文档，但是实际最大值还需要参考你的使用场景：包括你使用的硬件， 文档的大小和复杂程度，索引和查询文档的方式以及你期望的响应时长。 
>   3. 副本分片的作用：硬件故障时保护数据不丢失的冗余备份（容灾）；为搜索和返回文档等读操作提供服务（读写分离）。
>   4. 主分片的数量由索引决定，副本分片的数量可以修改，一个主分片可以对应零个至多个副本分片（要注意副本分片其实算是主分片的数据冗余，不能创建太多）



### 集群健康

```sense
GET /_cluster/health
```

此命令返回集群监控信息，具体如下

~~~ js
{
  "cluster_name" : "elasticsearch",		//集群名称
  "status" : "yellow",		//集群健康状态
  "timed_out" : false,
  "number_of_nodes" : 1,		//节点数
  "number_of_data_nodes" : 1,		
  "active_primary_shards" : 7,		
  "active_shards" : 7,
  "relocating_shards" : 0,
  "initializing_shards" : 0,
  "unassigned_shards" : 5,
  "delayed_unassigned_shards" : 0,
  "number_of_pending_tasks" : 0,
  "number_of_in_flight_fetch" : 0,
  "task_max_waiting_in_queue_millis" : 0,
  "active_shards_percent_as_number" : 58.333333333333336
}
~~~

status属性表示当前集群的健康状态，它三个状态值

- green： 所有的主分片和副本分片都正常运行。 
- yellow： 所有的主分片都正常运行，但不是所有的副本分片都正常运行。 
- red： 有主分片没能正常运行。 

### 故障转移（容灾）



### 水平扩容（

